# Frontend Deployment Overview - Churn Risk App

**Last Updated:** 2025-11-12
**Estimated Time:** 1-2 hours (first time)
**Cost:** ~$1-3/month (with $300 free tier credits)

---

## What We're Deploying

This guide will walk you through deploying the Nuxt 3 frontend to Google Cloud Platform (GCP) as a static site. By the end, you'll have:

✅ **Production-ready Nuxt 3 frontend** on Cloud Storage
✅ **Global CDN delivery** via Cloud CDN
✅ **Custom domain support** (optional)
✅ **HTTPS automatically** via Load Balancer
✅ **Fast worldwide performance** with edge caching
✅ **Simple CI/CD pipeline** for automatic deployments

---

## Architecture: Static vs Container Deployment

### Why Static? (Recommended)

**Cloud Storage + Cloud CDN** (What we're building):
```
User → Cloud CDN (edge cache) → Cloud Storage (static files)
                                    ↓
                            Backend API (Cloud Run)
```

**Advantages:**
- ✅ No Docker containerization issues
- ✅ Much cheaper (~$1-3/month vs $5-10/month)
- ✅ Better performance (CDN edge caching)
- ✅ Simpler deployment (just upload files)
- ✅ Global edge locations automatically
- ✅ Perfect for SPAs like your Nuxt app

**When this works:**
- ✅ Client-side authentication (Firebase Client SDK) ← You have this
- ✅ API calls from browser to backend ← You have this
- ✅ No server-side rendering needed ← Your app doesn't need this

### Alternative: Cloud Run (Not Recommended for Your Use Case)

**Cloud Run Container** (Skipping this):
```
User → Cloud Run (Nuxt SSR container) → Backend API
```

**Why we're NOT doing this:**
- ❌ Requires Docker (you had issues with backend)
- ❌ More expensive ($5-10/month)
- ❌ Adds complexity for no benefit
- ❌ Your app doesn't use SSR features
- ❌ Slower than CDN edge caching

---

## Current vs Production Architecture

### Current Local Setup

```
Your Machine:
├── Frontend: npm run dev (port 3000)
│   └── Talks to: http://localhost:8000
└── Backend: poetry run uvicorn (port 8000)
```

### Production Architecture (What You're Building)

```
Google Cloud Platform:
├── Cloud Storage Bucket
│   └── Static files (HTML, JS, CSS, images)
│       └── Generated by: nuxt generate
│
├── Cloud CDN
│   └── Caches content at edge locations worldwide
│       └── ~50-100 edge locations globally
│
├── Load Balancer (HTTPS)
│   └── Routes traffic to Cloud Storage
│       └── Custom domain support (optional)
│
└── Existing Backend (already deployed)
    ├── Cloud Run: churn-risk-api
    ├── Cloud SQL: PostgreSQL
    └── Secret Manager: credentials
```

**User Request Flow:**
1. User visits `https://your-domain.com`
2. Load Balancer terminates HTTPS
3. Cloud CDN checks edge cache (90%+ hits)
4. If cache miss, fetch from Cloud Storage
5. Browser loads app, calls backend API at `https://churn-risk-api-*.run.app`

---

## Deployment Sequence

### Phase 1: Prepare Frontend (30 min)
1. **Configure for Production** - Set production API URL and Firebase config
2. **Test Static Build** - Verify `nuxt generate` works locally
3. **Create .env.production** - Production environment variables

### Phase 2: GCP Setup (20 min)
4. **Create Storage Bucket** - Public bucket for static files
5. **Configure Load Balancer** - HTTPS and CDN setup
6. **Test Deployment** - Manual upload and verify

### Phase 3: Automation (20 min)
7. **CI/CD Pipeline** - Automatic deployments from GitHub
8. **Custom Domain** - (Optional) Add your domain
9. **Final Testing** - End-to-end production test

---

## Cost Breakdown (With Free Tier)

### Estimated Monthly Costs

**Static Frontend (What You're Building):**
```
Cloud Storage (5GB files):           $0.10/month
Cloud CDN (1000 requests/day):       $0.50/month
Load Balancer (forwarding rules):    $0.60/month
Network egress (to CDN):             $0.20/month
TOTAL:                               ~$1.40/month
```

**Light Production (1000 daily users):**
```
Cloud Storage:                       $0.10/month
Cloud CDN (10K requests/day):        $2.00/month
Load Balancer:                       $0.60/month
Network egress:                      $0.50/month
TOTAL:                               ~$3.20/month
```

**With $300 credits:** You're covered for 90+ months at current scale.

**Comparison to Cloud Run (Container):**
```
Cloud Run (container):               $5-10/month
Storage + CDN (static):              $1-3/month
SAVINGS:                             $4-7/month (60-70% cheaper)
```

---

## Prerequisites Checklist

Before starting, ensure you have:

**Required:**
- [x] Backend deployed to Cloud Run (you have this)
- [x] Frontend running locally (you have this)
- [x] gcloud CLI installed and authenticated
- [x] Firebase project configured (you have this)
- [ ] Node.js 18+ and npm installed

**Helpful to Have:**
- [ ] Custom domain (optional - can use *.web.app domain)
- [ ] GitHub repo connected (for CI/CD)

---

## What You'll Need During Deployment

**Existing Information:**
- Backend API URL: `https://churn-risk-api-461448724047.us-east1.run.app`
- Firebase Project ID: (from your existing setup)
- Firebase API Key: (from your existing setup)
- Firebase Auth Domain: (from your existing setup)

**New Information You'll Create:**
- GCS bucket name (e.g., `churn-risk-frontend-prod`)
- Load balancer name (e.g., `churn-risk-lb`)
- (Optional) Custom domain name

---

## Timeline Estimates

**Fast Track (Following Guide):**
- Phase 1: 30 minutes (configure & test build)
- Phase 2: 20 minutes (GCP setup)
- Phase 3: 20 minutes (CI/CD)
- **Total: ~70 minutes**

**First Time (Careful Testing):**
- Phase 1: 45 minutes
- Phase 2: 30 minutes
- Phase 3: 30 minutes
- **Total: ~105 minutes**

---

## Success Criteria

By the end of this deployment, you should have:

✅ A live frontend: `https://your-bucket-name.storage.googleapis.com` (or custom domain)
✅ Static files generated: `frontend/.output/public/`
✅ Files uploaded to Cloud Storage bucket
✅ HTTPS enabled via Load Balancer
✅ CDN caching working (fast global access)
✅ Frontend talking to production backend API
✅ Firebase auth working in production
✅ CI/CD pipeline deploying on git push
✅ (Optional) Custom domain configured

---

## What's NOT In This Guide

**Not Covered (Overkill for MVP):**
- Multi-region storage (single region is fine)
- Advanced CDN configuration (defaults work great)
- A/B testing with Traffic Director
- Preview environments per branch
- Infrastructure as Code (Terraform)

**When to Add These:**
- Multi-region: When you have global customers
- A/B testing: When you're optimizing conversion
- Preview envs: When team grows beyond 1-2 people
- IaC: When managing multiple environments

---

## Key Differences from Backend Deployment

**Backend (Docker on Cloud Run):**
- ❌ Had Docker/Poetry issues
- ❌ Required troubleshooting multiple builds
- ❌ Needed Procfile workaround
- Container runtime complexity

**Frontend (Static on Cloud Storage):**
- ✅ No Docker at all
- ✅ Just build and upload files
- ✅ No runtime issues
- Simple file serving

**Why This is Easier:**
1. Nuxt generates plain HTML/JS/CSS files
2. No server process to debug
3. No module import issues
4. No Python/Poetry complications
5. Just upload files to bucket

---

## Deployment Strategy

### Build Process (Local or CI/CD)

```bash
# 1. Install dependencies
npm install

# 2. Set production environment variables
export NUXT_PUBLIC_API_BASE=https://churn-risk-api-461448724047.us-east1.run.app
export NUXT_PUBLIC_FIREBASE_API_KEY=your-key
export NUXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your-domain
export NUXT_PUBLIC_FIREBASE_PROJECT_ID=your-project

# 3. Generate static files
npm run generate

# 4. Output location
# Files ready at: frontend/.output/public/
```

### Upload to Cloud Storage

```bash
# One-time bucket setup
gsutil mb -l us-east1 gs://churn-risk-frontend-prod
gsutil web set -m index.html -e 404.html gs://churn-risk-frontend-prod
gsutil iam ch allUsers:objectViewer gs://churn-risk-frontend-prod

# Deploy (every time)
gsutil -m rsync -R -d frontend/.output/public/ gs://churn-risk-frontend-prod/
```

---

## Testing Strategy

### Local Testing (Before Deploying)

```bash
# 1. Test static generation
npm run generate

# 2. Preview locally with production API
npm run preview
```

Visit `http://localhost:4173` and verify:
- App loads correctly
- Login/logout works
- API calls reach production backend
- All routes work (no 404s)

### Production Testing (After Deploying)

```bash
# Check bucket contents
gsutil ls -r gs://churn-risk-frontend-prod/

# Test direct bucket access
curl https://storage.googleapis.com/churn-risk-frontend-prod/index.html

# Test via CDN (after Load Balancer setup)
curl -I https://your-domain.com
# Should see: x-goog-stored-content-length header (CDN served)
```

---

## Comparison: Static vs Container Deployment

| Aspect | Static (Recommended) | Container (Alternative) |
|--------|---------------------|------------------------|
| **Deployment** | Upload files | Docker build + push |
| **Complexity** | Simple | Complex (you had issues) |
| **Cost** | $1-3/month | $5-10/month |
| **Performance** | Edge CDN caching | Single region server |
| **Global Speed** | Fast everywhere | Slow far from region |
| **Troubleshooting** | Minimal | ModuleNotFoundError, etc. |
| **CI/CD** | `npm run generate && gsutil rsync` | Multi-stage Docker build |
| **SSL/HTTPS** | Automatic (Load Balancer) | Automatic (Cloud Run) |
| **Scaling** | Infinite (CDN) | 0-1000 instances |
| **Your Use Case** | ✅ Perfect fit | ⚠️ Overkill |

---

## Ready to Start?

If you have:
- ✅ Backend API deployed and working
- ✅ Frontend running locally (`npm run dev`)
- ✅ 1-2 hours of time
- ✅ Want to avoid Docker issues

**→ Proceed to Guide 01: Configure Frontend for Production**

If not quite ready:
- Test local frontend: `cd frontend && npm run dev`
- Verify backend API: `curl https://churn-risk-api-461448724047.us-east1.run.app/health`
- Check Firebase config in browser console

---

## Guide Navigation

- **→ Next:** [01 - Configure Frontend for Production](01-configure-production.md)
- **↑ Up:** [Main Documentation](../../README.md)
- **Related:** [Backend Deployment](../cloud/00-overview.md)

---

**Questions before starting?** This deployment is much simpler than the backend - no Docker, no Poetry, just build and upload files!
